<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React IFrame Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .iframe-container {
        flex: 1;
        border: 2px solid #ccc;
        border-radius: 8px;
        overflow: hidden;
      }
      iframe {
        width: 100%;
        height: 400px;
        border: none;
      }
      .controls {
        margin-bottom: 20px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #007bff;
        color: white;
      }
      button:hover {
        background-color: #0056b3;
      }
      .json-input {
        width: 100%;
        height: 100px;
        margin: 10px 0;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>React IFrame Outputs Test</h1>

    <div class="controls">
      <h3>Controls</h3>
      <button onclick="loadVanilla()">Load Vanilla Mode</button>
      <button onclick="loadReact()">Load React Mode</button>
      <button onclick="sendHtmlContent()">Send HTML Content</button>
      <button onclick="sendJsonContent()">Send JSON Content</button>
      <button onclick="sendComplexData()">Send Complex Data</button>
    </div>

    <div class="container">
      <div class="iframe-container">
        <h3>Vanilla Mode</h3>
        <iframe id="vanilla-iframe" src="http://localhost:8000/"></iframe>
      </div>
      <div class="iframe-container">
        <h3>React Mode</h3>
        <iframe
          id="react-iframe"
          src="http://localhost:8000/react.html"
        ></iframe>
      </div>
    </div>

    <div>
      <h3>Custom JSON Content</h3>
      <textarea
        id="json-input"
        class="json-input"
        placeholder="Enter JSON content here..."
      >
{
  "title": "Custom Data",
  "items": ["Item 1", "Item 2", "Item 3"],
  "metadata": {
    "created": "2024-01-01",
    "version": "1.0"
  }
}</textarea
      >
      <button onclick="sendCustomJson()">Send Custom JSON</button>
    </div>

    <script>
      function loadVanilla() {
        document.getElementById("vanilla-iframe").src =
          "http://localhost:8000/";
      }

      function loadReact() {
        document.getElementById("react-iframe").src =
          "http://localhost:8000/react.html";
      }

      function sendHtmlContent() {
        const content = `
                <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                    <h2>Dynamic HTML Content</h2>
                    <p>This content was sent via postMessage to the vanilla iframe.</p>
                    <ul>
                        <li>Feature 1: Dynamic content updates</li>
                        <li>Feature 2: Real-time communication</li>
                        <li>Feature 3: Responsive design</li>
                    </ul>
                    <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;

        document.getElementById("vanilla-iframe").contentWindow.postMessage(
          {
            type: "update-content",
            content: content,
          },
          "*"
        );
      }

      function sendJsonContent() {
        const content = JSON.stringify({
          title: "Sample Data",
          items: ["Apple", "Banana", "Cherry"],
          count: 3,
          timestamp: new Date().toISOString(),
        });

        document.getElementById("react-iframe").contentWindow.postMessage(
          {
            type: "update-react-content",
            content: content,
          },
          "*"
        );
      }

      function sendComplexData() {
        const content = JSON.stringify({
          title: "Complex Interactive Data",
          datasets: [
            {
              name: "Sales Q1",
              values: [120, 190, 300, 500, 200, 300],
            },
            {
              name: "Sales Q2",
              values: [150, 230, 380, 420, 210, 340],
            },
          ],
          metadata: {
            description: "Quarterly sales data with interactive visualization",
            units: "thousands",
            lastUpdated: new Date().toISOString(),
          },
          config: {
            theme: "auto",
            showLegend: true,
            animate: true,
          },
        });

        document.getElementById("react-iframe").contentWindow.postMessage(
          {
            type: "update-react-content",
            content: content,
          },
          "*"
        );
      }

      function sendCustomJson() {
        const jsonInput = document.getElementById("json-input").value;
        try {
          // Validate JSON
          JSON.parse(jsonInput);

          document.getElementById("react-iframe").contentWindow.postMessage(
            {
              type: "update-react-content",
              content: jsonInput,
            },
            "*"
          );
        } catch (e) {
          alert("Invalid JSON: " + e.message);
        }
      }

      // Listen for height updates from iframes
      window.addEventListener("message", (event) => {
        if (event.data && event.data.type === "iframe-height") {
          console.log("Height update:", event.data.height);
        }
      });
    </script>
  </body>
</html>
